<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ConfiguraciÃ³n CLI Generada</title>
  <link href="{{ url_for('static', filename='css/success.css') }}" rel="stylesheet" type="text/css" />
  <script>
    function copyConfig(routerIndex) {
      const configBlock = document.getElementById(`config-${routerIndex}`);
      const text = configBlock.innerText;
      
      navigator.clipboard.writeText(text).then(() => {
        const msg = document.getElementById(`success-${routerIndex}`);
        msg.style.display = 'inline-block';
        setTimeout(() => {
          msg.style.display = 'none';
        }, 2000);
      });
    }

    function copyAllConfigs() {
      let allText = '';
      document.querySelectorAll('.command-block').forEach((block, index) => {
        if (index > 0) allText += '\n\n';
        allText += block.innerText;
      });
      
      navigator.clipboard.writeText(allText).then(() => {
        alert('Â¡Todas las configuraciones copiadas al portapapeles!');
      });
    }
  </script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ConfiguraciÃ³n CLI</h1>
      <p style="margin: 10px 0 0 0; color: #888;">Comandos generados para Cisco</p>
      {% if is_physical_mode %}
      <p style="margin: 10px 0 0 0; color: #ce9178; font-weight: bold;">
        Modo FÃ­sico - Modelos reales (sin PT Builder)
      </p>
      {% else %}
      <p style="margin: 10px 0 0 0; color: #4ec9b0; font-weight: bold;">
        Modo Digital - Con PT Builder
      </p>
      {% endif %}
    </div>

    {% for router in routers %}
    <div class="router-config">
      <h2>{{ router.name }}</h2>
      <button class="copy-btn" onclick="copyConfig({{ loop.index0 }})">ğŸ“‹ Copiar</button>
      <span id="success-{{ loop.index0 }}" class="success-message">âœ“ Copiado</span>
      <div style="clear: both;"></div>
      
      {% if router.routes %}
      <div class="routes-section">
        <h3>Rutas EstÃ¡ticas Generadas ({{ router.routes|length }} rutas)</h3>
        <p style="color: #888; font-size: 12px; margin: 5px 0 10px 0;">
          Las rutas fueron generadas automÃ¡ticamente respetando las direcciones de ruteo configuradas.
        </p>
      </div>
      {% endif %}
      
      <div class="command-block" id="config-{{ loop.index0 }}">
        {% for cmd in router.config[1:] %}
          {% if cmd.startswith('!') %}
            <div class="command comment">{{ cmd }}</div>
          {% else %}
            <div class="command">{{ cmd }}</div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
    {% endfor %}

    <!-- InformaciÃ³n de VLANs y Segmentos -->
    <div class="vlan-info-section">
      <h2>InformaciÃ³n de VLANs y Segmentos de Red</h2>
      <table class="vlan-table">
        <thead>
          <tr>
            <th>Dispositivo</th>
            <th>VLAN</th>
            <th>Tag</th>
            <th>Red/Segmento</th>
            <th>MÃ¡scara</th>
            <th>Gateway</th>
            <th>Rango Usable</th>
            <th>Total IPs</th>
          </tr>
        </thead>
        <tbody>
          {% for router in routers %}
            {% if router.vlans %}
              {% for vlan in router.vlans %}
                <tr>
                  <td>
                    <span class="device-badge {% if router.type == 'switch_core' %}switch-badge{% endif %}">
                      {{ router.name }}
                    </span>
                  </td>
                  <td><strong>{{ vlan.name }}</strong></td>
                  <td>{{ vlan.termination }}</td>
                  <td><code>{{ vlan.network }}</code></td>
                  <td><code>{{ vlan.mask }}</code></td>
                  <td><code>{{ vlan.gateway }}</code></td>
                  <td><code>{{ vlan.first_ip }} - {{ vlan.last_ip }}</code></td>
                  <td>{{ vlan.num_hosts }} hosts</td>
                </tr>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="actions">
      <button onclick="copyAllConfigs()">ğŸ“‹ Copiar Todas las Configuraciones</button>
      <button onclick="window.location.href='/download/completo'">ğŸ“¥ Descargar TODO</button>
      <button onclick="window.location.href='/download/routers'">ğŸ”€ Descargar Routers</button>
      <button onclick="window.location.href='/download/switch_cores'">ğŸ”„ Descargar Switch Cores</button>
      <button onclick="window.location.href='/download/switches'">ğŸ”Œ Descargar Switches</button>
      <button onclick="window.location.href='/download/wlan'" style="background: #58a6ff;">ğŸ“¡ Descargar WLAN Config</button>
      {% if not is_physical_mode %}
      <button onclick="window.location.href='/download/ptbuilder'" style="background: #ce9178;">ğŸ“¦ Descargar PTBuilder Script</button>
      {% endif %}
      <button onclick="window.print()">ğŸ–¨ï¸ Imprimir</button>
      <button onclick="window.location.href='/'">â† Nueva ConfiguraciÃ³n</button>
    </div>
  </div>
</body>
</html>
